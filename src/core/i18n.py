
TRANSLATIONS = {
    # Login
    "welcome_back": {"ar": "أهلاً بك", "en": "WELCOME BACK"},
    "system_title": {"ar": "نظام مراقبة العقود", "en": "Contract Monitor System"},
    "username": {"ar": "اسم المستخدم", "en": "Username"},
    "password": {"ar": "كلمة المرور", "en": "Password"},
    "login_btn": {"ar": "دخول", "en": "LOGIN"},
    "invalid_creds": {"ar": "بيانات الدخول غير صحيحة", "en": "Invalid credentials"},
    "image_not_found": {"ar": "الصورة غير موجودة", "en": "Image not found"},
    
    # Sidebar
    "dashboard": {"ar": "الرئيسية", "en": "Dashboard"},
    "smart_search": {"ar": "البحث الذكي", "en": "Smart Search"},
    "cv_translator": {"ar": "ترجمة السير الذاتية", "en": "CV Translator"},
    "permissions": {"ar": "الصلاحيات", "en": "Permissions"},
    "logout": {"ar": "تسجيل خروج", "en": "Logout"},
    "debug": {"ar": "فحص الأخطاء", "en": "Debug"},
    "test_db": {"ar": "فحص قاعدة البيانات", "en": "Test DB"},
    "programmer": {"ar": "Programmed by Alsaeed Alwazzan", "en": "Programmed by Alsaeed Alwazzan"},

    # Dashboard
    "contract_dashboard": {"ar": "لوحة العقود", "en": "Contract Dashboard"},
    "no_data": {"ar": "لا توجد بيانات", "en": "No data found"},
    "urgent_7_days": {"ar": "عاجل (7 أيام)", "en": "Urgent (7 Days)"},
    "expired": {"ar": "منتهي", "en": "Expired"},
    "active": {"ar": "ساري", "en": "Active"},
    "urgent": {"ar": "عاجل", "en": "Urgent"},
    "cv_download": {"ar": "تحميل السيرة الذاتية", "en": "CV Download"},
    "download_pdf": {"ar": "تحميل PDF", "en": "Download PDF"},
    "tabs_urgent": {"ar": " عاجل", "en": " Urgent"},
    "tabs_expired": {"ar": " منتهي", "en": " Expired"},
    "tabs_active": {"ar": " ساري", "en": " Active"},

    # Search
    "smart_search_title": {"ar": "البحث الذكي (AI)", "en": "Smart AI Search"},
    "search_placeholder": {"ar": "مثال: سائق فلبيني، +96650...", "en": "e.g. Filipino Driver, +96650..."},
    "search_btn": {"ar": "بحث", "en": "Search"},
    "no_results": {"ar": "لا توجد نتائج", "en": "No results"},
    "advanced_filters": {"ar": "تصفية متقدمة", "en": "Advanced Filters"},
    "refresh_data_btn": {"ar": "تحديث البيانات من المصدر", "en": "Refresh Data from Source"},
    "preview_cv": {"ar": "معاينة", "en": "Preview"},
    "selected_worker": {"ar": "العامل المختار", "en": "Selected Worker"},
    "translate_cv_btn": {"ar": "ترجمة السيرة الذاتية لهذا العامل", "en": "Translate this Worker's CV"},
    "loading_cv": {"ar": "جاري جلب السيرة الذاتية...", "en": "Fetching CV..."},
    "close": {"ar": "إغلاق", "en": "Close"},

    # Translator
    "translator_title": {"ar": "ترجمة السير الذاتية", "en": "CV Translator"},
    "translator_desc": {"ar": "ارفع ملف السيرة الذاتية (PDF) ليتم استخراج النص وترجمته للعربية.", "en": "Upload a CV (PDF) to translate it from English to Arabic automatically."},
    "upload_cv": {"ar": "رفع الملف", "en": "Upload CV"},
    "translate_now": {"ar": "ترجم الآن", "en": "Translate Now"},
    "extracting": {"ar": "جاري الاستخراج والترجمة...", "en": "Extracting & Translating..."},
    "original": {"ar": "النص الأصلي (English)", "en": "Original (English)"},
    "translated": {"ar": "النص المترجم (عربي)", "en": "Translated (Arabic)"},
    "download_trans": {"ar": "تحميل الترجمة", "en": "Download Translation"},

    # Permissions
    "permissions_title": {"ar": "إدارة الصلاحيات", "en": "Permissions Management"},
    "add_user": {"ar": "إضافة مستخدم جديد", "en": "Add New User"},
    "role": {"ar": "الصلاحية", "en": "Role"},
    "add_btn": {"ar": "إضافة", "en": "Add User"},
    "users_list": {"ar": "قائمة المستخدمين", "en": "Users List"},
    "edit_user": {"ar": "تعديل مستخدم", "en": "Edit User"},
    "select_user": {"ar": "اختر المستخدم", "en": "Select User"},
    "new_password": {"ar": "كلمة المرور الجديدة (اختياري)", "en": "New Password (Optional)"},
    "update_btn": {"ar": "تحديث البيانات", "en": "Update User"},
    "update_success": {"ar": "تم التحديث بنجاح", "en": "Updated successfully"},
    "user_exists": {"ar": "المستخدم موجود مسبقاً", "en": "User already exists"},
    "user_added": {"ar": "تمت الإضافة بنجاح", "en": "User added successfully"},
    "image_error": {"ar": "خطأ في الصورة", "en": "Image Error"},
    
    # Common
    "error": {"ar": "خطأ", "en": "Error"},
    "success": {"ar": "نجاح", "en": "Success"},


    # Column Headers (Exact Matches from User Data)
    "columns": {
        "طابع زمني": {"ar": "وقت التسجيل", "en": "Timestamp"},
        "Full Name:": {"ar": "الاسم الكامل", "en": "Full Name"},
        "Nationality": {"ar": "الجنسية", "en": "Nationality"},
        "Gender": {"ar": "الجنس", "en": "Gender"},
        "Phone Number": {"ar": "رقم الهاتف", "en": "Phone Number"},
        "Is your contract expired": {"ar": "هل العقد منتهي؟", "en": "Is your contract expired?"},
        "When is your contract end date?": {"ar": "تاريخ انتهاء العقد", "en": "Contract End Date"},
        "your Age:": {"ar": "العمر", "en": "Age"},
        "Are you working now?": {"ar": "هل تعمل حالياً؟", "en": "Are you working now?"},
        "Do you have any financial obligations towards your previous sponsor": {"ar": "هل لديك التزامات مالية للكفيل السابق؟", "en": "Financial Obligations"},
        "Do you have to report Huroob": {"ar": "هل لديك بلاغ هروب؟", "en": "Huroob Report"},
        "If you are Huroob, how many days or months have you been Huroob?": {"ar": "مدة الهروب", "en": "Huroob Duration"},
        "Will your employer accept to transfer your sponsorship": {"ar": "هل يقبل الكفيل النقل؟", "en": "Sponsorship Transfer"},
        "Are you in Saudi Arabia now": {"ar": "هل أنت في السعودية؟", "en": "In KSA?"},
        "Which city in Saudi Arabia are you in": {"ar": "المدينة", "en": "City"},
        "What is the name of the area where you live?": {"ar": "المنطقة/الحي", "en": "Area"},
        "Do you speak Arabic": {"ar": "هل تتحدث العربية؟", "en": "Speaks Arabic"},
        "Which job are you looking for": {"ar": "الوظيفة المطلوبة", "en": "Job Requested"},
        "How much experience do you have in this field?": {"ar": "الخبرة في هذا المجال", "en": "Experience"},
        "What other jobs can you do": {"ar": "مهارات أخرى", "en": "Other Skills"},
        "How much experience do you have in this field?_1": {"ar": "الخبرة (أخرى)", "en": "Experience (Other)"},
        "Do you have Card Baladiya": {"ar": "هل لديك كرت بلدية؟", "en": "Baladiya Card"},
        "Is the Card Baladiya  valid?": {"ar": "هل الكرت ساري؟", "en": "Card Valid?"},
        "how many months Card Baladiya valid": {"ar": "مدة صلاحية الكرت (أشهر)", "en": "Card Validity (Months)"},
        "how many months Card Baladiya expires": {"ar": "متى ينتهي الكرت (أشهر)", "en": "Card Expiry (Months)"},
        "Can you work outside your city": {"ar": "هل يمكنك العمل خارج مدينتك؟", "en": "Work Outside City"},
        "Are you ready to work immediately?": {"ar": "هل أنت جاهز للعمل فوراً؟", "en": "Ready Immediately"},
        "Are you married and do your children reside with you in Saudi Arabia?": {"ar": "الحالة الاجتماعية وهل العائلة معك؟", "en": "Marital Status & Family"},
        "Iqama ID number": {"ar": "رقم الإقامة", "en": "Iqama ID"},
        "What is the occupation listed on your Iqama": {"ar": "المهنة في الإقامة", "en": "Iqama Profession"},
        "your Iqama Valid": {"ar": "هل الإقامة سارية؟", "en": "Iqama Valid"},
        "If the Iqama is valid, how many months are left?": {"ar": "المدة المتبقية في الإقامة", "en": "Iqama Remaining"},
        "If the Iqama expired how many months ago?": {"ar": "مدة انتهاء الإقامة", "en": "Iqama Expired Since"},
        "How many times did you transfer your sponsorship": {"ar": "عدد مرات نقل الكفالة", "en": "Transfer Count"},
        "Download CV": {"ar": "تحميل السيرة الذاتية", "en": "Download CV"},
        "How did you know us?": {"ar": "كيف عرفت عنا؟", "en": "How did you know us?"}
    }
}

def t(key, lang="ar"):
    return TRANSLATIONS.get(key, {}).get(lang, key)

def t_col(col_name, lang="ar"):
    """Translates a column name using exact lookups from the `columns` dictionary."""
    if lang == 'en': return col_name
    
    col_str = str(col_name).strip()
    
    # 1. Try Exact Match
    res = TRANSLATIONS.get("columns", {}).get(col_str, {}).get("ar")
    if res: return res
    
    # 2. Try Case-Insensitive Match
    cols_map = {k.strip().lower(): v.get("ar") for k, v in TRANSLATIONS.get("columns", {}).items()}
    res_fuzzy = cols_map.get(col_str.lower())
    if res_fuzzy: return res_fuzzy
    
    # 3. Enhanced Partial Matches (Fallback)
    col_lower = col_str.lower()
    
    # Prioritize specific partials causing issues
    if "financial obligations" in col_lower: return "الالتزامات المالية"
    if "card baladiya" in col_lower: return "كرت البلدية"
    if "iqama" in col_lower: return "الإقامة"
    if "experience" in col_lower: return "الخبرة"
    if "huroob" in col_lower: return "الهروب"
    if "contract end" in col_lower: return "تاريخ انتهاء العقد"
    
    return col_name
